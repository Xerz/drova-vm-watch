
# VM Rebooter

Скрипт для мониторинга состояния удалённого сервиса и перезагрузки виртуальной машины в `libvirt`, когда сессия завершается.  

## Установка и запуск

### 1. Клонируем репозиторий

```bash
git clone https://github.com/yourname/drova-vm-watch.git
cd drova-vm-watch
````

### 2. Создаём виртуальное окружение

```bash
python -m venv rebooter-venv
source rebooter-venv/bin/activate
```

### 3. Устанавливаем зависимости

```bash
pip install -r requirements.txt
```

### 4. Настраиваем переменные окружения

Скопируйте пример файла и отредактируйте под свои значения:

```bash
cp .env.example .env
```

Переменные в `.env`:

* `SERVER_UUID` — UUID сервера (над именем сервера на странице "Мои серверы")
* `USER_ID` — ID пользователя (можно взять из файла реестра)
* `AUTH_TOKEN` — токен авторизации (из файла реестра)
* `VM_NAME` — имя виртуальной машины в `libvirt`
* `SLEEP_TIME` — задержка между проверками состояния (секунды)
* `LOG_LEVEL` — уровень логирования (`DEBUG`, `INFO`, `ERROR`)

### 5. Запускаем скрипт


```bash
python watch_vm.py
```

Для использования `libvirt` запускать нужно с **правами суперпользователя**

## Конфигурация

Работает на `python 3.13.5`
Man

## ⚙️ Пример работы

* Обнаружение окончания сессии:
  * Ждёт, пока сервер перейдёт в состояние `BUSY` или `HANDSHAKE`
  * ~~Следит за окончанием этих состояний~~ Затем ждёт состояния `LISTEN`
    * Во время сессии статус может стать `OFFLINE`, поэтому "ждать окончания `BUSY` или `HANDSHAKE`" не подходит
* При завершении сессии отправляет команду **reboot** в выбранную виртуальную машину через `libvirt`

---
